{% load static %}
<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="{% static 'CSS/style_home_customer.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'CSS/UI_customer.css' %}">
    {% comment %} <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script> {% endcomment %}
    <script src="https://kit.fontawesome.com/0284d1fcc6.js" crossorigin="anonymous"></script>
    <script src="{% static 'JS/style.js' %}"></script>
    <link rel="stylesheet" href="{% static 'CSS/fontawesome.min.css' %}">
    {% comment %} <link rel="stylesheet" href="{% static 'CSS/bootstrap.min.css' %}"> {% endcomment %}
    <link rel="stylesheet" href="{% static 'CSS/templatemo-style.css' %}">
    <link
      rel="icon"
      type="image/x-icon"
      href="{% static 'images/logo5.ico' %}"
    />
    <title>Furin</title>
  </head>
  <body>
    <header class="bg-dark">
      <div class="container">
        <nav class="nav_bar">
          <div>
            <img class="logo_img" style="width:50px; height:50px;" src="{% static 'images/logo_light.png' %}"></img>
            <a href="#" class="logo">Furin</a>
            <ul class="nav-links">
              <li><a class="nav__hover" href="#">
              </a></li>
              <li><a class="nav__hover" href="#">Contact</a></li>
            </ul>
          </div>
          <div>
            <ul id="nav-links" class="nav-links">
              <li>
                <div class="nav__cta__info--has-menu--book_car">
                  {% if not order%}
                  <div class="nav_cta_history">
                    <a class="nav__hover" href="#">History book</a>
                  </div>
                  {%else%}
                  <div class="nav_cta_history">
                    <a class="nav__hover" href="#">History is None</a>
                  </div>
                  {%endif%}
                  <div class="nav__cta__menu_history_book">
                    <div class="block_history_book_car">
                        <div class="tm-history-items">
                          <ul>
                            {% for order in my_orders%}
                              <li>
                                <div class="block_info_history">
                                  <div class="block_info_img"><img src="{% static 'images/img1.png '%}" alt="Avatar Image" class="rounded-circle"></div>
                                  <div class="block__content__history">
                                      <div class="content_history_book">
                                        <p class="mb-2"><b>Name-Schedule : {{order.name_schedule_order}}</b>
                                      </div>
                                      <div class ="content_history_book">
                                          <a href="#" class="tm-notification-link"> Số chỗ :{{order.quantity_slot}}</a></p>
                                      </div>
                                      <div class= "content_history_book">
                                        <span class="tm-small tm-text-color-secondary">{{order.pickup_datetime}}</span>
                                      </div>
                                  </div>
                              </div>
                              </li>
                            {%endfor%}
                          </ul>  
                        </div>
                    </div>
                  </div>  
                </div>
              </li>
              {% if request.customer %}
              <li>
                <div class="nav__cta__info--has-menu">
                  <div class="nav__cta__info">
                    <p class="nav__cta">{{request.customer.name_customer}}</p>
                    <p class="nav__mores"><i class="fa-solid fa-caret-down" style="color: #ff4405;"></i></p>
                  </div>
                  <div class="nav__cta__menu">
                    <ul class="nav__cta__list">
                      <li class="nav__cta__item">
                        <a href="{% url 'handle_logout' %}" class="nav__cta__link">
                          <i class="fa-solid fa-arrow-right-from-bracket" style="color: #ff4000;"></i>
                          <div class="nav__cta__function">
                              <span class="nav__cta__functionname">Logout</span>
                          </div>
                        </a>
                      </li>
                      <li class="nav__cta__item">
                        <a href="" class="nav__cta__link">
                          <i class="fa-solid fa-arrow-right-from-bracket" style="color: #ff4000;"></i>
                          <div class="nav__cta__function">
                              <span class="nav__cta__functionname">function </span>
                          </div>
                        </a>
                      </li>
                      <li class="nav__cta__item">
                        <a href="" class="nav__cta__link">
                          <i class="fa-solid fa-arrow-right-from-bracket" style="color: #ff4000;"></i>
                          <div class="nav__cta__function">
                              <span class="nav__cta__functionname">function</span>
                          </div>
                        </a>
                      </li>
                    </ul>
                  </div>
                </div>
              </li>
              {% else %}
              <li><a class="nav__hover" href="{% url 'redirectRegister'%}">Log in</a></li> 
              <li><a class="nav__noLogin" href="{% url 'redirectRegister'%}" class="nav__cta">Sign up</a></li>
              {% endif %}
            </ul>
          </div>
          <div class="hamburger">
            <span class="hamburger-bar"></span
            ><span class="hamburger-bar"></span>
            <span class="hamburger-bar"></span>
          </div>
        </nav>
      </div>
    </header>
    {% if request.customer %}
    <section id="main__cta_customer">
      <div class="container">
        <div class="container_customer">
          <!-- row -->
          <div class="row tm-content-row">
            <div class="block_head_flex">
                <div class="col-sm-12 col-md-12 col-lg-6 col-xl-6 tm-block-col">
                  <div class="tm-bg-primary-dark-block_book_car">
                    {% comment %} <h2 class="tm-block-title">Search</h2> {% endcomment %}
                    <form method="GET" action="{% url 'search_customer' %}" class="search-form">
                      <div class="input_book_car">
                          {{ my_filter_form.as_p }}
                          <button type="submit" class="bt_search"><i class="fa fa-search" style="font-size: 20px;
                            color: #101648;"></i></button>
                      </div>
                      <div class="group_button_search_book">
                        
                      </div>
                    </form>
                  </div> 
                </div >
            </div>
              <div class="col-12 tm-block-col block_info_schedules">
                  <div class="tm-bg-primary-dark tm-block tm-block-taller tm-block-scroll">
                      <h2 class="tm-block-title">Danh sách các chuyến đi </h2>
                      <table class="table">
                          <thead>
                              <tr>
                                  <th scope="col">NAME CarOwner</th>
                                  <th scope="col">STATUS</th>
                                  <th scope="col">NAME DRIVER</th>
                                  <th scope="col">NAME VEHICLE</th>
                                  <th scope="col">QUANTITY_SLOT</th>
                                  <th scope="col">PICKUP_LOCATION</th>
                                  <th scope="col">DROPOFF_LOCATION</th>
                                  <th scope="col">START_TIME</th>
                                  <th scope="col">START_DAY</th>
                              </tr>
                          </thead>
                          <tbody>
                              {% for schedule in schedules %}
                              <tr>
                                  <th scope="row"><b>{{schedule.vehicle.driver.carowner.username}}</b></th>
                                  <td>
                                      <div class="tm-status-circle waiting">
                                      </div>confirm
                                  </td>
                                  <td><b>{{schedule.vehicle.name_driver}}</b></td>
                                  <td><b>{{schedule.vehicle.name_vehicle}}</b></td>
                                  <td><b>{{schedule.slot_vehicle}}</b></td>
                                  <td><b>{{schedule.start_location}}</b></td>
                                  <td><b>{{schedule.end_location}}</b></td>
                                  <td>{{schedule.start_time}}</td>
                                  <td>{{schedule.start_date}}</td>
                                  <td><button class="bt_book_car" 
                                     data-schedule-id="{{ schedule.id }}" 
                                     data-customer-id="{{ request.customer.id }}"
                                     data-carownername ="{{schedule.vehicle.driver.carowner.username}}"
                                     data-drivername ="{{schedule.vehicle.name_driver}}"
                                     data-vehiclename ="{{schedule.vehicle.name_vehicle}}"
                                     data-startlocation ="{{schedule.start_location}}"
                                     data-endlocation ="{{schedule.end_location}}"
                                     data-quantityslot ="{{schedule.vehicle.slot_vehicle}}"
                                     data-startday ="{{schedule.start_date}}"
                                     >Book</button></td>
                              </tr>
                              {% endfor %}
                          </tbody>
                      </table>
                  </div>
              </div>
          </div>
      </div>
      </div>
    </section>
    {% else %}
    <section id="main__cta">
      <div class="container">
        <div class="split">
          <div class="main__cta__rectangle bg-light">
            <div class="split main__cta__options">
              <div class="main__cta__card tab-item active">
                <div class="main__cta__icon">
                  <i class="fa-solid fa-bus" style="font-size:26px;"></i>
                </div>
                Book a car
              </div>
              <div class="main__cta__card tab-item">
                <i class="fa-regular fa-user" style="font-size:26px;"></i>
                Driver
              </div>
              <div class="main__cta__card tab-item">
                <i class="fa-solid fa-user" style="font-size:26px;"></i>
                CarOwner
              </div>
              <div class="line"></div>
            </div>
            <div class="main__cta__text active">
              <h1> Đăng nhập Nhà xe </h1>
              <p class="sous-titre">
                Sẳn sàng để vào giao diện quản lý của bạn chưa 
              </p>
              <a href="{% url 'redirectRegister' %}" class="btn">Sign up</a>
              <a href="#" class="text-cta" 
              >
            </div>
            <div class="main__cta__text active">
              <h1>Đăng ký Driver </h1>
              <p class="sous-titre">
                Chúng tôi sẳn sàng để đi cùng bạn 
              </p>
              <a href="{% url 'driver_login_view' %}" class="btn">Sign up</a>
              <a href="#" class="text-cta" 
              >
            </div>
            <div class="main__cta__text ">
              <h1>Đăng ký khách hàng </h1>
              <p class="sous-titre">
                Chúng tôi sẳn sàng để đi cùng bạn
              </p>
              <a href="{% url 'controller_redirect_regisCustomer' %}" class="btn">Sign up</a>
              <a href="#" class="text-cta" 
              >
            </div>
          </div>
          {% comment %} ----------------------------- {% endcomment %}
        </div>
      </div>
    </section>
    {% endif %}
    <section id="business-header">
      <div class="container">
        <div class="business-header__text resetcolor">
          <h3>Furin bên bạn trong những chuyến đi</h3>
          <p>
           Tôi tìm thấy mình trong những chuyến đi,
           cảm giác đó không thể nào thay thế được bởi những thứ khác.
           Lý do chính kéo tôi vào cuộc hành trình , chỉ đơn giản là những
           khung hình trong đôi mắt mình thay đổi khi những con đường lướt qua
          </p>
          {% comment %} <a href="#" class="btn">Bắt đầu đặt</a> {% endcomment %}
        </div>
      </div>
    </section>

    <section data-aos="zoom-in" id="engagements__section" class="bg-light">
      <div class="container">
        <h3><i class="fa-solid fa-circle-info" style="color: #fe4001;"></i> Tập trung vào sự an toàn mọi lúc mọi nơi</h3>
        <div class="split home__conten">
          
          <div class="engagements__section__flex Titlecolor1">
            <img
              src="{%static 'images/bg11.jpg'%}"
              alt=""
            />
            <h4>Cam kết của chúng tôi đối với sự an toàn của bạn</h4>
            <p class="sous-titre__home__conten">
              Yên thảo như bích ty,
              Tần tang đê lục chi.
              Đương quân hoài quy nhật,
              Thị thiếp đoạn trường thì.
              Xuân phong bất tương thức,
              Hà sự nhập la vi?
            </p>
            <div class="Home__conten__footer">
              <a href="#" class="text-cta home__conten"
              ><i class="fa-solid fa-book-open"></i> Khám phá điều lệ </a
            >
            <a href="#" class="text-cta footer"
              ><i class="fa-solid fa-angles-right"></i> xem thêm tính năng bảo mật</a
            >
            </div>
          </div>
          <div class="engagements__section__flex Titlecolor2">
            <img
               src="{%static 'images/bg13.jpg'%}"
              alt=""
            />
            <h4>Tầm phủ rộng trong khắp mọi thành phố</h4>
            <p class="sous-titre__home__conten">
              Yên Chi hoàng diệp lạc,
              Thiếp vọng tự đăng đài.
              Hải thượng bích vân đoạn,
              Thiền Vu thu sắc lai.
              Hồ binh sa tái hợp,
              Hán sứ Ngọc Quan hồi.
              Chinh khách vô quy nhật,
              Không bi huệ thảo tồi.
            </p>
            <div class="Home__conten__footer">
              <a href="#" class="text-cta"
              ><i class="fa-solid fa-book-open"></i> Khám phá điều lệ </a
            >
            <a href="#" class="text-cta footer"
              ><i class="fa-solid fa-angles-right"></i> xem thêm tính năng bảo mật</a
            >
            </div>
          </div>
        </div>
      </div>
    </section>

    <section data-aos="fade-up" id="infos__section" class="bg-light">
      <div class="container">
        <div class="split">
          <div class="infos__section__card">
            <img
              src="https://www.uber-assets.com/image/upload/q_auto:eco,c_fill,w_24,h_24/v1542256135/assets/dd/c53d7b-8921-4dc7-93f4-45fb59f4ffb9/original/person-multiple-outlined.svg"
              alt=""
            />
            <p class="titre">ý tưởng của chúng tôi </p>
            <p class="sous-titre">
              tôi sẻ cho bạn biết nguồn động lực và ý tưởng để chúng tôi làm ra website này
            </p>
            <a href="#" class="text-cta">Tìm hiểu thêm</a>
          </div>
          <div class="infos__section__card">
            <img
              src="https://www.uber-assets.com/image/upload/q_auto:eco,c_fill,w_24,h_24/v1542254244/assets/eb/68c631-5041-4eeb-9114-80048a326782/original/document-outlined.svg"
              alt=""
            />
            <p class="titre">Trang xã hội của chúng tôi </p>
            <p class="sous-titre">
              Nơi chúng tôi chia sẻ những thông tin về bản thân và những câu chuyện về những chuyến đi của chúng tôi
            </p>
            <a href="#" class="text-cta">Tìm hiểu thêm</a>
          </div>
          <div class="infos__section__card">
            <img
              src="https://www.uber-assets.com/image/upload/q_auto:eco,c_fill,w_24,h_24/v1542255370/assets/64/58118a-0ece-4f80-93ee-8041b53593d5/original/home-outlined.svg"
              alt=""
            />
            <p class="titre">Ý tưởng phát triển </p>
            <p class="sous-titre">
              Chúng tôi sẻ cho bạn biết dự định của bản thân ý tưởng phát triển trong tương lai.
            </p>
            <a href="#" class="text-cta">Tìm hiểu thêm</a>
          </div>
        </div>
      </div>
    </section>

    <footer class="bg-dark">
      <div class="container">
        <nav>
          <div><a href="#" class="logo">Furin</a></div>
          <div>
            <a href="#">Sẳn sàng đồng hành cùng bạn trong mọi chuyến đi</a>
          </div>
        </nav>
      </div>
    </footer>
    <div class="invoice_block_book">
      <div class="nav_invoice">
        <div class="invoice_logo">
          <img class="incoive_logo_img" style="width:50px; height:50px;" src="{% static 'images/logo_light.png' %}"></img>
          <a href="#" class="logo">Invoice</a>
        </div>
        <div class="invoice_conten_right">
          <div class="span_iconoutbook">✘</div>
        </div>
      </div>
      <div class="invoice_container">
        <div class="invoice_container_title">
          <p class="carownername">Lã Tiểu Ngư</p>
        </div>
        <div class="invoice_container_conten">
          <div class="invoice_info_book">
            <div class="invoice_info_book-title">
              <p>Driver: </p>
            </div>
            <div>
            <p class="drivername">none</p>
            </div>
          </div>
          <div class="invoice_info_book">
            <div class="invoice_info_book-title">
              <p>Vehicle: </p>
            </div>
            <p class="vehiclename">none</p>
          </div>
          <div class="invoice_info_book">
            <div class="invoice_info_book-title">
              <p>Start location: </p>
            </div>
            <p class="startlocation">none</p>
          </div>
          <div class="invoice_info_book">
            <div class="invoice_info_book-title">
              <p>End location: </p>
            </div>
            <p class="endlocation">none</p>
          </div>
          <div class="invoice_info_book">
            <div class="invoice_info_book-title">
              <p>Start day : </p>
            </div>
            <p class="startday">none</p>
          </div>
          <div class="invoice_info_book">
            <div class="invoice_info_book-title">
              <p>Choses quantity slots: </p>
            </div>
            <input  class="input_quantity" type="number" name="quantity" min="1" max="5">
          </div>
        </div>
      </div>
      <div class="invoice_footer">
        <button class="invoice_bt">Confirm</button>
      </div>
    </div>
    <script src="{% static 'JS/book.js' %}"></script>
    <script>

      document.addEventListener("DOMContentLoaded", function () {
          const input_quantity= document.querySelector('.input_quantity')
          const invoice = document.querySelector('.invoice_block_book')
          const container = document.querySelector('.container')
  
          const bookButtons = document.querySelectorAll(".bt_book_car");
          const carownername = document.querySelector('.carownername')
          const drivername = document.querySelector('.drivername')
          const vehiclename = document.querySelector('.vehiclename')
          const startlocation = document.querySelector('.startlocation')
          const endlocation = document.querySelector('.endlocation')
          const button_confirm = document.querySelector('.invoice_bt')
          const startday = document.querySelector('.startday')
          console.log(bookButtons)
          bookButtons.forEach(button => {
              button.addEventListener("click", function () {
                  const scheduleId = this.dataset.scheduleId;
                  const customerId = this.dataset.customerId;
                  const carownername_get = this.getAttribute('data-carownername')
                  const drivername_get = this.getAttribute('data-drivername')
                  const vehiclename_get = this.getAttribute('data-vehiclename')
                  const startlocation_get = this.getAttribute('data-startlocation')
                  const endlocation_get = this.getAttribute('data-endlocation')
             
                  const quantityslot = this.getAttribute('data-quantityslot')
                  const startday_get = this.getAttribute('data-startday')
                  
                  {% comment %} console.log(scheduleId)
                  console.log(customerId)
                  console.log(carownername_get)
                  console.log(drivername_get)
                  console.log(vehiclename_get)
                  console.log(startlocation_get)
                  console.log(endlocation_get)
                  console.log(container)
                  console.log(startday_get) {% endcomment %}
                  
                  {% comment %} -----------set info invoice ------------- {% endcomment %}

                  carownername.innerHTML=carownername_get
                  drivername.innerHTML=drivername_get
                  vehiclename.innerHTML=vehiclename_get
                  startlocation.innerHTML=startlocation_get
                  endlocation.innerHTML=endlocation_get
                  startday.innerHTML =startday_get
                  input_quantity.max = quantityslot
                  container.classList.add("show");
                  invoice.style.display ='block'

                console.log(button_confirm)
                button_confirm.onclick= function (){
                    const slot = input_quantity.value
                    console.log(slot)
                  fetch(`/book_vehicle/${scheduleId}/${customerId}/${slot}/`, {
                      method: "POST",
                      headers: {
                        "X-CSRFToken": "{{ csrf_token }}",  
                      },
                  })
                  .then(response => response.json())
                  .then(data => {
                      
                      if (data.message) {
                          alert(data.message); 
                          container.classList.remove("show");
                          invoice.style.display ='none'
                      } else if (data.error) {
                          alert(data.error); 
                      }
                  })
                  .catch(error => {
                      console.error("Đã xảy ra lỗi:", error);
                  }); 
                  } 
                  
                  const searchIcon = document.querySelector('.search-icon');
                  const spanIconoutbook = document.querySelector('.span_iconoutbook');
                  console.log(spanIconoutbook)
                  spanIconoutbook.onclick= function(){
                    container.classList.remove("show");
                    invoice.style.display ='none'
                  }
                  searchIcon.onclick=function(){
                      const searchForm = document.querySelector('.search-form');
                      searchForm.submit(); 
                  }

              });
          });
      });
  </script>
  
  </body>
</html>